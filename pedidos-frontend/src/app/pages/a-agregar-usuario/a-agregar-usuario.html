<section class="container mx-auto pb-8 section">
    <div class="up-page py-2 px-6 section40">
        <h2>{{ isEditMode ? 'Editar usuario' : 'Agregar usuario' }}</h2>
        <div>Bienvenido, {{nameOfUser}}</div>
    </div>
    <div class="main-page">

        <p><em>*Admin</em>: Obligario para administrador o editor.</p>
        <p class="pb-8"><em>*Cliente</em>: Obligario para cliente.</p>

        <form [formGroup]="userForm" class="space-y-6 py-4 mx-auto relative" novalidate>
            <div class="columns-form">
                <div class="form-left">
                    <div class="block mb-12">
                        <label class="block mb-1 font-medium">Usuario de ingreso <em>(*Admin)(*Cliente)</em></label>
                        <input type="text" formControlName="username" class="w-full px-4 py-3" />
                        <p *ngIf="userForm.get('username')?.touched && userForm.get('username')?.invalid"
                            class="text-red-600 text-sm mt-1 txt-validate">
                            El usuario de ingreso es obligatorio.
                        </p>
                    </div>

                    <div class="block mb-12">
                        <label class="block mb-1 font-medium">Contraseña <em>(*Admin)(*Cliente)</em></label>
                        <input type="text" formControlName="password" class="w-full px-4 py-3" />
                        <p *ngIf="userForm.get('password')?.touched && userForm.get('password')?.invalid"
                            class="text-red-600 text-sm mt-1 txt-validate">
                            La contraseña es obligatoria.
                        </p>
                    </div>

                    <div class="block mb-12">
                        <label class="block mb-1 font-medium">Tipo de usuario <em>(*Admin)(*Cliente)</em></label>

                        <div class="flex gap-2 mt-4 flex-col">
                            <label class="flex items-center gap-2">
                                <input type="radio" formControlName="userType" value="client" class="accent-blue-600" />
                                Cliente
                            </label>

                            <label class="flex items-center gap-2">
                                <input type="radio" formControlName="userType" value="admin" class="accent-blue-600" />
                                Administrador
                            </label>

                            <label class="flex items-center gap-2">
                                <input type="radio" formControlName="userType" value="editor" class="accent-blue-600" />
                                Editor
                            </label>
                        </div>

                        <p *ngIf="userForm.get('userType')?.touched && userForm.get('userType')?.invalid"
                            class="text-red-600 text-sm mt-1 txt-validate">
                            El tipo de usuario es obligatorio.
                        </p>
                    </div>

                    <div class="block mb-12">
                        <label class="block mb-1 font-medium">Nombre <em>(*Admin)(*Cliente)</em></label>
                        <input type="text" formControlName="name" class="w-full px-4 py-3" />
                        <p *ngIf="userForm.get('name')?.touched && userForm.get('name')?.invalid"
                            class="text-red-600 text-sm mt-1 txt-validate">
                            El nombre es obligatorio.
                        </p>
                    </div>

                    <div class="block mb-12">
                        <label class="block mb-1 font-medium">Correo electrónico <em>(*Admin)(*Cliente)</em></label>
                        <input type="email" formControlName="email" class="w-full px-4 py-3" />
                        <p *ngIf="userForm.get('email')?.touched && userForm.get('email')?.invalid"
                            class="text-red-600 text-sm mt-1 txt-validate">
                            El correo electrónico es obligatorio.
                        </p>
                    </div>

                    <div class="block mb-12">
                        <label class="block mb-1 font-medium">Estado <em>(*Admin)(*Cliente)</em></label>

                        <select formControlName="status" class="w-full px-4 py-3">
                            <option value="">Seleccione un estado</option>
                            <option value="active">Activo</option>
                            <option value="inactive">Inactivo</option>
                        </select>

                        <p *ngIf="userForm.get('status')?.touched && userForm.get('status')?.errors?.['required']"
                            class="text-red-600 text-sm mt-1 txt-validate">
                            El estado es obligatorio.
                        </p>
                    </div>

                </div>
                <div class="form-right">

                    <div class="block mb-12">
                        <label class="block mb-1 font-medium">RUC <em>(*Cliente)</em></label>
                        <input type="text" formControlName="ruc" class="w-full px-4 py-3" maxlength="11" />
                        <!-- <p *ngIf="userForm.get('nombre')?.touched && userForm.get('nombre')?.invalid"
                            class="text-red-600 text-sm mt-1 txt-validate">
                            El nombre es obligatorio.
                        </p> -->
                    </div>

                    <div class="block mb-12">
                        <label class="block mb-1 font-medium">Teléfono <em>(*Cliente)</em></label>
                        <input type="tel" formControlName="phone" class="w-full px-4 py-3" />
                        <!-- <p *ngIf="userForm.get('phone')?.touched && userForm.get('phone')?.invalid"
                            class="text-red-600 text-sm mt-1 txt-validate">
                            El Teléfono es obligatorio.
                        </p> -->
                    </div>

                    <div class="block mb-12">
                        <label class="block mb-1 font-medium">Lead time days <em>(*Cliente)</em></label>
                        <input type="text" formControlName="leadTimeDays" class="w-full px-4 py-3" />
                        <!-- <p *ngIf="userForm.get('leadTimeDays')?.touched && userForm.get('leadTimeDays')?.invalid"
                            class="text-red-600 text-sm mt-1 txt-validate">
                            Los productos solicitados son obligatorios.
                        </p> -->
                    </div>

                    <div class="block mb-12">
                        <label class="block mb-1 font-medium">Correos de copia (Dividirlos por comas)
                            <em>(*Cliente)</em></label>
                        <input type="text" formControlName="ccEmails" class="w-full px-4 py-3" />
                        <!-- <p *ngIf="userForm.get('ccEmails')?.touched && userForm.get('ccEmails')?.invalid"
                            class="text-red-600 text-sm mt-1 txt-validate">
                            Los correos de copia son obligatorios.
                        </p> -->
                    </div>

                    <div class="block mb-12">
                        <label class="block mb-1 font-medium">Productos que más solicita</label>
                        <input type="text" formControlName="usualProductsNotes" class="w-full px-4 py-3" />
                        <!-- <p *ngIf="userForm.get('usualProductsNotes')?.touched && userForm.get('usualProductsNotes')?.invalid"
                            class="text-red-600 text-sm mt-1 txt-validate">
                            Los productos solicitados son obligatorios.
                        </p> -->
                    </div>

                    <div class="block mb-12">
                        <label class="block mb-1 font-medium">Observaciones</label>
                        <textarea formControlName="observations" class="w-full px-4 py-3 resize-y min-h-[100px]"
                            rows="4" placeholder="Escribe tus observaciones aquí..."></textarea>
                    </div>

                </div>
            </div>

            <div *ngIf="showError && typeError" class="mt-3 block w-full text-red-600 text-xs txt-error">
                <svg xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 640 640"><!--!Font Awesome Pro v7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2025 Fonticons, Inc.-->
                    <path
                        d="M320 64C334.7 64 348.2 72.1 355.2 85L571.2 485C577.9 497.4 577.6 512.4 570.4 524.5C563.2 536.6 550.1 544 536 544L104 544C89.9 544 76.9 536.6 69.6 524.5C62.3 512.4 62.1 497.4 68.8 485L284.8 85C291.8 72.1 305.3 64 320 64zM320 232C306.7 232 296 242.7 296 256L296 368C296 381.3 306.7 392 320 392C333.3 392 344 381.3 344 368L344 256C344 242.7 333.3 232 320 232zM346.7 448C347.3 438.1 342.4 428.7 333.9 423.5C325.4 418.4 314.7 418.4 306.2 423.5C297.7 428.7 292.8 438.1 293.4 448C292.8 457.9 297.7 467.3 306.2 472.5C314.7 477.6 325.4 477.6 333.9 472.5C342.4 467.3 347.3 457.9 346.7 448z" />
                </svg>
                <span>{{ typeError }}</span>
            </div>

            <div class="container-btns">
                <button type="button" (click)="submit()" class="btn">
                    {{ isEditMode ? 'Guardar cambios' : 'Agregar usuario' }}
                </button>
                <button (click)="volverListaUsuarios()" class="btn-secondary">
                    Volver
                </button>
            </div>
        </form>


    </div>

    <app-modal-confirmacion [mostrar]="mostrarModalConfirmacion"
        [mensaje]="'¿Seguro que deseas volver? Los cambios no se guardarán.'" (confirmar)="confirmarVolver()"
        (cancelar)="cancelarVolver()">
    </app-modal-confirmacion>

    <div *ngIf="mostrarModalExito" class="fixed inset-0 flex items-center justify-center z-50 open-modal-exito">
        <div class="bg-white rounded shadow-md p-6 w-11/12 md:w-1/3 relative">
            @if (isEditMode) {
            <div class="flex items-center flex-col modal-icon text-center">
                <svg xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 640 640"><!--!Font Awesome Free v7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
                    <path
                        d="M320 112C434.9 112 528 205.1 528 320C528 434.9 434.9 528 320 528C205.1 528 112 434.9 112 320C112 205.1 205.1 112 320 112zM320 576C461.4 576 576 461.4 576 320C576 178.6 461.4 64 320 64C178.6 64 64 178.6 64 320C64 461.4 178.6 576 320 576zM404.4 276.7C411.4 265.5 408 250.7 396.8 243.6C385.6 236.5 370.8 240 363.7 251.2L302.3 349.5L275.3 313.5C267.3 302.9 252.3 300.7 241.7 308.7C231.1 316.7 228.9 331.7 236.9 342.3L284.9 406.3C289.6 412.6 297.2 416.2 305.1 415.9C313 415.6 320.2 411.4 324.4 404.6L404.4 276.6z" />
                </svg>
                <h3 class="text-gray-700">¡Hecho!</h3>
            </div>

            <div class="py-4 text-center">
                <p class="text-gray-700">{{titleModalExito}}</p>
            </div>
            } @else {
            <div class="flex items-center flex-col modal-icon text-center pb-4">
                <h4 class="pb-4">{{titleModalExito}}</h4>
                <p>Comparte los accesos con el nuevo usuario.</p>
            </div>

            <div class="flex items-center justify-center pb-6">
                <div class="text-gray-700 border-gray-200 border p-4 rounded-lg bg-gray-50">
                    <p>Usuario: {{newUser}}</p>
                    <p>Contraseña: {{newPassword}}</p>
                </div>
                <div (click)="copyToClipboard(newUser, newPassword)" class="ml-4 flex items-center justify-center flex-col cursor-pointer">
                    <div class="icon-copy">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path fill="currentColor"
                            d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17A2,2 0 0,0 4,19H16A2,2 0 0,0 18,17V3A2,2 0 0,0 16,1Z" /> </svg>
                    </div>
                    <span>Copiar</span> 
                </div>
                
            </div>
            }


            <div class="flex justify-center pt-6 border-t border-gray-200">
                <button (click)="irAListaUsuarios()" class="text-white font-bold py-2 px-4 rounded btn">
                    Aceptar
                </button>
            </div>
        </div>
    </div>

</section>